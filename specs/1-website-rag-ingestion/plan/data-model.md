# Data Model: Website-based Knowledge Ingestion and Vectorization Pipeline

**Feature**: 1-website-rag-ingestion
**Created**: 2025-12-17
**Status**: Draft

## Entity: TextChunk

**Description**: Represents a semantically meaningful segment of extracted content from a webpage

### Fields
- **id** (string, required): Unique identifier for the chunk (UUID format)
- **content** (string, required): The actual text content (300-500 words)
- **url** (string, required): Original URL of the source webpage
- **title** (string, required): Title of the source webpage
- **section** (string, optional): Section or heading hierarchy from the source
- **word_count** (integer, required): Number of words in the content
- **created_at** (datetime, required): Timestamp when the chunk was created
- **source_html_tag** (string, optional): HTML tag that contained this content (e.g., "p", "li", "blockquote")

### Relationships
- Associated with one VectorEmbedding (1:1)
- Associated with one ChunkMetadata (1:1)

### Validation Rules
- content.length >= 300 words
- content.length <= 500 words
- url must be valid URL format
- word_count must match actual content word count

## Entity: VectorEmbedding

**Description**: Numerical representation of text content generated by the embedding model

### Fields
- **chunk_id** (string, required): Reference to the associated TextChunk
- **vector** (array of floats, required): The embedding vector values
- **embedding_model** (string, required): Model identifier ("embed-english-v3.0")
- **embedding_version** (string, required): Version of the embedding model
- **embedding_dimensions** (integer, required): Number of dimensions in the vector
- **created_at** (datetime, required): Timestamp when the embedding was generated

### Relationships
- Associated with one TextChunk (1:1)
- Stored in Qdrant collection "book_content"

### Validation Rules
- vector.length must match expected dimensions for embed-english-v3.0 (typically 1024 or 768)
- embedding_model must be "embed-english-v3.0"
- chunk_id must reference an existing TextChunk

## Entity: ChunkMetadata

**Description**: Additional metadata associated with a text chunk for search and retrieval

### Fields
- **chunk_id** (string, required): Reference to the associated TextChunk
- **source_url** (string, required): Original page URL (duplicate for convenience)
- **page_title** (string, required): HTML title of source page
- **section_hierarchy** (array of strings, optional): Breadcrumb path or heading structure
- **crawl_timestamp** (datetime, required): When the page was crawled
- **content_type** (string, optional): Type of content (e.g., "paragraph", "list", "heading")
- **position_in_page** (integer, optional): Sequential position of this chunk in the source page
- **related_chunks** (array of strings, optional): IDs of semantically related chunks

### Relationships
- Associated with one TextChunk (1:1)

### Validation Rules
- chunk_id must reference an existing TextChunk
- source_url must be valid URL format
- section_hierarchy items must be non-empty strings

## Entity: CrawledPage

**Description**: Represents a webpage that has been successfully crawled and processed

### Fields
- **url** (string, required): The URL of the crawled page
- **title** (string, required): Page title extracted from HTML
- **content_length** (integer, required): Length of extracted content in characters
- **crawl_status** (string, required): Status of crawl ("success", "error", "skipped")
- **crawl_timestamp** (datetime, required): When the page was crawled
- **error_message** (string, optional): Error message if crawl failed
- **processed_chunks_count** (integer, required): Number of chunks created from this page
- **metadata** (object, optional): Additional metadata from the page

### Relationships
- Contains many TextChunks (1:many)

### Validation Rules
- url must be valid URL format
- crawl_status must be one of the allowed values
- content_length must be non-negative

## Entity: QdrantRecord

**Description**: The final record format stored in Qdrant vector database

### Fields
- **id** (string, required): Unique identifier for the record in Qdrant
- **vector** (array of floats, required): The embedding vector
- **payload** (object, required): Metadata object with structure:
  - text (string): The chunk text content
  - title (string): Page title
  - url (string): Source URL
  - section (string): Section heading
- **payload.text** (string, required): The chunk text content
- **payload.title** (string, required): Page title
- **payload.url** (string, required): Source URL
- **payload.section** (string, required): Section heading

### Relationships
- Based on VectorEmbedding and ChunkMetadata
- Stored in Qdrant collection "book_content"

### Validation Rules
- id must be unique within the collection
- vector must have correct dimensions
- payload must contain all required fields
- payload.text must match the content of the associated TextChunk

## State Transitions

### TextChunk States
- **Created**: Chunk has been created from source content
- **Embedded**: Embedding has been generated for the chunk
- **Stored**: Chunk has been saved to Qdrant

### CrawledPage States
- **Discovered**: URL found in sitemap
- **Fetched**: Page content retrieved
- **Processed**: Content extracted and chunked
- **Completed**: All chunks stored in vector database

## Constraints and Business Rules

1. **Chunk Size Constraint**: All TextChunk entities must have content between 300-500 words
2. **Domain Constraint**: All URLs must be within the ai-humanoid-robots-hakathon.vercel.app domain
3. **Embedding Model Constraint**: All embeddings must use embed-english-v3.0 model for consistency
4. **Metadata Preservation**: All source metadata must be preserved through the pipeline
5. **Data Integrity**: Each chunk must have associated embedding and metadata records
6. **Uniqueness**: Each chunk ID must be unique across the system
7. **Completeness**: A CrawledPage is only considered complete when all its chunks are stored in Qdrant

## Indexes and Performance Considerations

### Required Indexes
1. **TextChunk.url**: For efficient lookup by source URL
2. **VectorEmbedding.chunk_id**: For joining embeddings with chunks
3. **ChunkMetadata.chunk_id**: For joining metadata with chunks
4. **CrawledPage.url**: For unique URL lookup
5. **QdrantRecord.id**: Primary key for vector database

### Performance Optimizations
1. **Vector Index**: Qdrant automatically creates vector index for similarity search
2. **Payload Indexing**: Consider indexing frequently queried payload fields in Qdrant
3. **Batch Operations**: Use batch operations for efficient storage of multiple records